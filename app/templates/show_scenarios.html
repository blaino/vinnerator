<script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>

<script>
  function loadSavedScenario(x) {
      window.location.replace("/show_scenarios/" + x.value);
  }

  function deleteSelected() {
      var y = $('#saved :selected').val()
      window.location.replace("/delete/" + y);
  }
  
</script>

<div id="wrap">
{% extends "layout.html" %}
{% block body %}
  <div class="container">
    <form action="{{ url_for('add_scenario' ) }}" method=post id="advancedForm" class="form-horizontal">
      {{ form.hidden_tag() }}
      <div class="form-group">
	<h4><label for="inputEmail3" class="col-md-1 control-label">Scenario</label></h4>
	<div class="col-md-3">
	  <input class="form-control scenario" type="text" size=12 name="title" id="title" value="{{scenarios[index].title}}">
	</div>
      </div>
      <div class="row">
	<div class="col-md-4">
	  <table class="table">
	    <tr>
	      <td>
		<h4>Some Heading</h4>
	      </td>
	      <td>
	    	<div class="input-group basic-input"></div>
	      </td>
	    </tr>
            <tr>
	      <td>
		<a class="btn large primary has_popover" rel="popover"
		   data-content="What does cash on cash requirement mean? Expressed as a percentage of shazbat">
		  Cash on cash
		</a>
	      </td>
	      <td>
		<div class="input-group basic-input">
		  <span class="input-group-addon mono">&nbsp</span>
		  <input type=text class="percentage form-control right" name="cash_on_cash" id="cash_on_cash" value={{scenarios[index].cash_on_cash}}>
		  <span class="input-group-addon mono">%</span>
		</div>
	      </td>
            </tr>
            <tr>
	      <td>
		<a class="btn large primary has_popover" rel="popover"
		   data-content="Loan to value of acquisition price (target)">
		  loan-to-value  
		</a>
	      </td>
	      <td>
		<div class="input-group basic-input">
		  <span class="input-group-addon mono">&nbsp</span>
		  <input type=text class="percentage form-control right" name="target_ltv" id="target_ltv" value={{scenarios[index].target_ltv}}>
		  <span class="input-group-addon mono">%</span>
		</div>
	      </td>
            </tr>
	    <tr>
	      <td>
		<a class="btn large primary has_popover" rel="popover"
		   data-content="Mezzanine debt percentage of capital stack">
		  Mezzanine Debt
		</a>
	      </td>
	      <td>
		<div class="input-group basic-input">
		  <span class="input-group-addon mono">&nbsp</span>
		  <input type=text class="percentage form-control right" name="mezz_debt" id="mezz_debt" value={{scenarios[index].mezz_debt}}>
		  <span class="input-group-addon mono">%</span>
		</div>
	      </td>
            </tr>
	    <tr>
	      <td>
		<a class="btn large primary has_popover" rel="popover"
		   data-content="Transfer costs of acquisition">
		  Transfer cost
		</a>
	      </td>
	      <td>
		<div class="input-group basic-input">
		  <span class="input-group-addon mono">&nbsp</span>
		  <input type=text class="percentage form-control right" name="transfer_cost" id="transfer_cost" value={{scenarios[index].transfer_cost}}>
		  <span class="input-group-addon mono">%</span>
		</div>

	      </td>
            </tr>
            <tr>
	      <td>
		<a class="btn large primary has_popover" rel="popover"
		   data-content="Buyer's percentage share of transfer costs">
		  Buyer's share
		</a>
	      </td>
	      <td>
		<div class="input-group basic-input">
		  <span class="input-group-addon mono">&nbsp</span>
		  <input type=text class="percentage form-control right" name="transfer_buyer_share" id="transfer_buyer_share" value={{scenarios[index].transfer_buyer_share}}>
		  <span class="input-group-addon mono">%</span>
		</div>
	      </td>
            </tr>
	    <tr>
	      <td>
		<a class="btn large primary has_popover" rel="popover"
		   data-content="Recordation costs of mortgages per $1000">
		  Recordation
		</a>
	      </td>
	      <td>
		<div class="input-group basic-input">
		  <span class="input-group-addon mono">$</span>
		  <input type=text class="dollar form-control right" name="recordation_cost" id="recordation_cost" value={{scenarios[index].recordation_cost}}>
		  <span class="input-group-addon mono">&nbsp</span>
		</div>
	      </td>
            </tr>
            <tr>
	      <td>
		<a class="btn large primary has_popover" rel="popover"
		   data-content="Buyer's percentage share of recordation costs">
		  Buyer's share
		</a>
	      </td>
	      <td>
		<div class="input-group basic-input">
		  <span class="input-group-addon mono">&nbsp</span>
		  <input type=text class="percentage form-control right" name="recordation_buyer_share" id="recordation_buyer_share" value={{scenarios[index].recordation_buyer_share}}>
		  <span class="input-group-addon mono">%</span>
		</div>
	      </td>
	    </tr>
	    <tr>
	      <td>
		<a class="btn large primary has_popover" rel="popover"
		   data-content="Finance Fees (e.g., appraisal, Phae I, Lender Fees, Legal, etc.)">
		  Finance fees
		</a>
	      </td>
	      <td>
		<div class="input-group basic-input">
		  <span class="input-group-addon mono">&nbsp</span>
		  <input type=text class="percentage form-control right" name="finance" id="finance" value={{scenarios[index].finance}}>
		  <span class="input-group-addon mono">%</span>
		</div>
	      </td>
	    </tr>
	  </table>
	</div>
	<div class="col-md-4">
	  <table class="table">
	    <tr>
	      <td>
		<h4>First Mortgage</h4>
	      </td>
	      <td>
		<div class="input-group basic-input"></div>
	      </td>
	    </tr>
	    <tr>
	      <td>
		<a class="btn large primary has_popover" rel="popover"
		   data-content="Interest rate of the first mortgage">
		  Interest
		</a>
	      </td>
	      <td>
		<div class="input-group basic-input">
		  <span class="input-group-addon mono">&nbsp</span>
		  <input type=text class="number form-control right" name="interest" id="interest" value={{scenarios[index].interest}}>
		  <span class="input-group-addon mono">%</span>
		</div>
	      </td>
	    </tr>
	    <tr>
	      <td>
		<a class="btn large primary has_popover" rel="popover"
		   data-content="Amortization period of first mortgage expressed in years.">
		  Amortization
		</a>
	      </td>
	      <td>
		<div class="input-group basic-input">
		  <span class="input-group-addon mono">&nbsp</span>
		  <input type=text class="number form-control right" name="amort" id="amort" value={{scenarios[index].amort}}>
		  <span class="input-group-addon mono">y</span>
		</div>
	      </td>
            </tr>
	    <tr>
	      <td>
		<h4>Mezzanine</h4>
	      </td>
	      <td>
		<div class="input-group basic-input"></div>
	      </td>
	    </tr>
            <tr>
	      <td>
		<a class="btn large primary has_popover" rel="popover"
		   data-content="Interest rate for mezzanine loan">
		  Mezzanine rate
		</a>
	      </td>
	      <td>
		<div class="input-group basic-input">
		  <span class="input-group-addon mono">&nbsp</span>
		  <input type=text class="percentage form-control right" name="mezz_rate" id="mezz_rate" value={{scenarios[index].mezz_rate}}>
		  <span class="input-group-addon mono">%</span>
		</div>
	      </td>
            </tr>
            <tr>
	      <td>
		<a class="btn large primary has_popover" rel="popover"
		   data-content="Interest only (yes or no)">
		  interest only
		</a>
	      </td>
	      <td>
		<div class="input-group basic-input">
		  <span class="input-group-addon mono">&nbsp</span>
		  <input type=text class="yesno form-control right" name="mezz_interest_only" id="mezz_interest_only"
			 value={% if scenarios[index].mezz_interest_only %}Yes{% else %}No{% endif %}>
		  <span class="input-group-addon mono">&nbsp</span>
		</div>
	      </td>
            </tr>
            <tr>
	      <td>
		<a class="btn large primary has_popover" rel="popover"
		   data-content="Secured loan (yes or no)">
		  secured
		</a>
	      </td>
	      <td>
		<div class="input-group basic-input">
		  <span class="input-group-addon mono">&nbsp</span>
		  <input type=text class="yesno form-control right" name="mezz_secured" id="mezz_secured"
			 value={% if scenarios[index].mezz_secured %}Yes{% else %}No{% endif %}>
		  <span class="input-group-addon mono">&nbsp</span>
		</div>
	      </td>
            </tr>
	    <tr>
	      <td>
		<a class="btn large primary has_popover" rel="popover"
		   data-content="Amortization period of mezzanine loan expressed in years">
		  amortization
		</a>
	      </td>
	      <td>
		<div class="input-group basic-input">
		  <span class="input-group-addon mono">&nbsp</span>
		  <input type=text class="percentage form-control right" name="mezz_amort" id="mezz_amort" value={{scenarios[index].mezz_amort}}>
		  <span class="input-group-addon mono">y</span>
		</div>
	      </td>
            </tr>
            <tr>
	      <td>
		<a class="btn large primary has_popover" rel="popover"
		   data-content="Percentage Appreciation or Depreciation of Asset Over Hold Period
				 (1% appreciation per year of hold period reasonable default, e.g., 5 year hold, 5% appreciation)">
		  Appreciation
		</a>
	      </td>
	      <td>
		<div class="input-group basic-input">
		  <span class="input-group-addon mono">&nbsp</span>
		  <input type=text class="percentage form-control right" name="apprec_depr" id="apprec_depr" value={{scenarios[index].apprec_depr}}>
		  <span class="input-group-addon mono">%</span>
		</div>
	      </td>
            </tr>
	    <tr>
	      <td>
		<a class="btn large primary has_popover" rel="popover"
		   data-content="Projected hold period expressed in years">
		  Holding period
		</a>
	      </td>
	      <td>
		<div class="input-group basic-input">
		  <span class="input-group-addon mono">&nbsp</span>
		  <input type=text class="number form-control right" name="holding_period" id="holding_period" value={{scenarios[index].holding_period}}>
		  <span class="input-group-addon mono">y</span>
		</div>
	      </td>
            </tr>
	  </table>
	</div>
	<div class="col-md-4">
	  <div class="panel panel-default">
	    <div class="panel-body">
	      <table class="table">
		<tr>
		  <td>1st Mort</td>
		  <td>{{ '%.3f' % result.first_mort }}</td>
		</tr>
		<tr>
		  <td>Mezz</td>
		  <td>{{ '%.3f' % result.mezz}}</td>
		</tr>
		<tr>
		  <td>Yield</td>
		  <td>{{ '%.3f' % result.calc_yield}}</td>
		</tr>
		<tr>
		  <td>Amort 1st Mort</td>
		  <td>{{ '%.3f' % result.amort_first_mort}}</td>
		</tr>
		<tr>
		  <td>Amort Mezz</td>
		  <td>{{ '%.3f' % result.amort_mezz}}</td>
		</tr>
		<tr>
		  <td>Appr</td>
		  <td>{{ '%.3f' % result.appr}}</td>
		</tr>
	      </table>
	      <h4 align="center">Cap Rate: {{ '%.3f' % result.cap_rate}}</h4>
	      <h4 align="center">Offer Price Cap Rate: {{ '%.3f' % result.op_cap_rate}}</h4>
	      <p align="center"><input type=submit value="Capulate!" class="btn btn-primary"></p>
	    </div>
	  </div>
	</div>
      </div>
    </form>
    <script>
      cap.setupValidation();
      cap.validate("#advancedForm");
      $(".has_popover").popover({offset: 10, trigger: 'hover'});
    </script>
  </div>

  <div class="container">  
    <form name="scenarioSelector" class="form-horizontal">
      <div class="form-group">
	<div class="col-md-4">
	  <h4>Saved Scenarios</h4>
	  <select id='saved' onchange="loadSavedScenario(this)" class="form-control"> 
	    {% for i in range(scenarios|length) %}
	    {% if i == index %}
	    <option value="{{i}}" selected>{{ scenarios[i].title }}</option>
	    {% else %}
	    <option value="{{i}}">{{ scenarios[i].title }}</option>
	    {% endif %}
	    {% else %}
	    <li><em>Unbelievable.  No saved scenarios here so far</em>
	      {% endfor %}
	  </select>
	</div>
      </div>
      <input type="button" class="btn btn-primary" value="Delete selected" onclick="deleteSelected()">
    </form>
  </div>
</container>
{% endblock %}
</div>

